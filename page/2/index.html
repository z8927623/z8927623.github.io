<!doctype html>
<html class="theme-next   use-motion ">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.4.5.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="Wild Yaoyao's blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.2" />






<meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Wild Yaoyao's blog">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Wild Yaoyao's blog">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Wild Yaoyao's blog">
<meta name="twitter:description">



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    sidebar: 'post',
    motion: true
  };
</script>


  <title> Wild Yaoyao's blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  






  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Wild Yaoyao's blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">野瑶瑶的技术博客</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            关于
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>


 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
  <section id="posts" class="posts-expand">

    

    
    
      
      

      
    

    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/02/01/Objective-C Runtime之概览/" itemprop="url">
                  Objective-C Runtime之概览
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-02-01T00:00:00+08:00" content="2016-02-01">
              2016-02-01
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/02/01/Objective-C Runtime之概览/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/02/01/Objective-C Runtime之概览/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>什么，你和我说runtime，大多数iOS程序员听到runtime的时候，脑子里第一反映便是，这货太特么抽象难理解了，而且工作中不常用到。的确，我也是这么认为的，Objective-C里两大最难的点当属Runtime和Runloop。然而，难虽难，这硬骨头还是要啃啊，不然理解不到这门语言的精髓呀。</p>
<p>我们都知道，Objective-C这门语言是动态的，是扩充于C的面向对象语言，所谓动态的核心就是<code>Runtime</code>。平常写程序的时候，它被系统加载进去，然后在幕后默默工作着，我们甚至察觉不到它的存在。但是，假如没有它，OC就运行不了了。也就是说，<code>C + Runtime = Objctive-C</code>。</p>
<h1 id="runtime-h">runtime.h</h1><p>runtime是开源的，我们可以在<a href="https://opensource.apple.com/tarballs/objc4/" target="_blank" rel="external">https://opensource.apple.com/tarballs/objc4/</a>下载。</p>
<p>runtime.h里声明了以下开头的函数，我们通过观察类的命名可以发现：</p>
<ul>
<li><code>objc_...</code><br>和runtime一些属性设置有关。比如<ul>
<li>类相关<br>创建一个类（<em>objc_allocateClassPair</em>）、注册该类（<em>objc_registerClassPair</em>）、销毁该类（<em>objc_disposeClassPair</em>）、指定类名返回该类（<em>objc_getClass</em>）、指定类名返回该类元类（<em>objc_getMetaClass</em>）、获取注册的类的列表（<em>objc_getClassList</em>或者<em>objc_copyClassList</em>）等</li>
<li>对象相关<br>设置关联对象（<em>objc_setAssociatedObject</em>），获取关联对象（<em>objc_getAssociatedObject</em>）等。</li>
<li>协议相关<br>创建一个协议（<em>objc_allocateProtocol</em>）、注册该协议（<em>objc_registerProtocol</em>）、指定协议名字获取协议（<em>objc_getProtocol</em>）、运行时所有的协议名（<em>objc_copyProtocolList</em>）等。</li>
</ul>
</li>
<li><p><code>class_...</code><br>和类相关。<br>比如获取类名（<em>class_getName</em>）、为类添加一个新的方法（<em>class_addMethod</em>）、获取类对应选择器的方法描述Method（<em>class_getClassMethod</em>）、获取类的变量列表（<em>class_copyIvarList</em>）、属性列表（<em>class_copyPropertyList</em>）、协议列表（<em>class_copyProtocolList</em>）、方法列表（<em>class_copyMethodList</em>）等。</p>
</li>
<li><p><code>object_..</code><br>和对象相关。<br>比如获取对象的类名（<em>object_getClassName</em>）、获取对象某个变量的值（<em>object_getIvar</em>）等。</p>
</li>
<li><p><code>method_...</code><br>和方法描述有关。<br>比如获取方法名SEL（<em>method_getName</em>）、方法的实现IMP（<em>method_getImplementation</em>）、参数和返回参数的类型编码（<em>method_getTypeEncoding</em>）等。</p>
</li>
<li><p><code>ivar_...</code><br>和变量有关。<br>比如获取变量名（<em>ivar_getName</em>）、实例变量的类型编码（<em>ivar_getTypeEncoding</em>）等。</p>
</li>
<li><p><code>property_...</code><br>和属性方法有关。<br>比如获取属性名（<em>property_getName</em>）、属性的编码（<em>property_getAttributes</em>）等。</p>
</li>
<li><p><code>protocol_...</code><br>和协议有关。<br>比如获取协议名（<em>protocol_getName</em>）、协议的方法描述（protocol_getMethodDescription）、判断某个协议是否实现另一个协议（<em>protocol_conformsToProtocol</em>）等。</p>
</li>
<li><p><code>sel_...</code><br>和方法选择器selectors有关。<br>比如获取选择器的名字（<em>sel_getName</em>）、注册一个选择器（<em>sel_registerName</em>或者<em>sel_getUid</em>）等。</p>
</li>
<li><p><code>imp_...</code><br>和方法的实现有关。<br>比如用block实现某selector的具体实现（<em>imp_implementationWithBlock</em>）等</p>
</li>
</ul>
<h1 id="foundation-h">foundation.h</h1><p><code>Foundation</code>是一个framework，它定义了OC类的基础。其中，NSObject类是Cocoa里大部分类的基类，它定义了一些基础的方法，比如<code>description</code>方法，NSObject对这个方法的实现仅仅是返回对象的名字和地址，我们可以通过覆写该方法来返回更多的信息。</p>
<p>除了实现了一些基本的方法，NSObject也定义了部分的runtime接口：</p>
<ul>
<li><code>- (Class)class;</code></li>
<li><code>- (BOOL)isKindOfClass:(Class)class;</code></li>
<li><code>- (BOOL)isMemberOfClass:(Class)aClass;</code></li>
<li><code>- (BOOL)respondsToSelector:(SEL)selector;</code></li>
<li><code>+ (BOOL)instancesRespondToSelector:(SEL)aSelector;</code></li>
<li><code>- (id)performSelector:(SEL)selector;</code></li>
<li><code>- (IMP)methodForSelector:(SEL)aSelector;</code></li>
<li><code>+ (IMP)instanceMethodForSelector:(SEL)aSelector;</code></li>
<li><code>- (void)doesNotRecognizeSelector:(SEL)aSelector;</code></li>
<li><code>- (BOOL)conformsToProtocol:(Protocol *)aProtocol;</code></li>
<li><code>+ (BOOL)conformsToProtocol:(Protocol *)protocol;</code></li>
</ul>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/01/28/你必须了解的Xcode调试技巧/" itemprop="url">
                  你必须了解的Xcode调试技巧
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-01-28T00:00:00+08:00" content="2016-01-28">
              2016-01-28
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/01/28/你必须了解的Xcode调试技巧/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/01/28/你必须了解的Xcode调试技巧/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>我们开发iOS或者OSX程序时候，调试是避免不了的，而调试最大的一个利器就是断点。接下来我介绍一下Xcode一些常用的和不常用的技巧。</p>
<h4 id="条件断点">条件断点</h4><p>如下图，这是个最基本的断点，我们写了一个0到10000的循环，需要在循环到5000的时候打个断点。</p>
<p><img src="/images/debug_1.png" alt="debug_1"></p>
<p>我们在Condition里填写我们的条件，这样当idx=5000的时候程序就会停在这里。</p>
<h4 id="高级log术">高级log术</h4><p>经常在调试程序的时候，我们需要在程序里面打印一些东西，最常用的就是NSLog，但是NSLog有几个缺点</p>
<ul>
<li>NSLog会拖慢运行速度，效率低</li>
<li>大量log导致代码混乱</li>
<li>最重要的一点，假如我们在程序运行的时候想要打印某些信息，这个时候我们可能会想到使用<code>po</code>，这个在打印单个信息的时候很有用，但是比如在上面我们的循环里面，我需要知道每次偶数的时候的idx是多少，那就不得不在编写完后重新编译运行，很麻烦。</li>
</ul>
<p>那么怎么办呢，还是在条件断点里面设置</p>
<p><img src="/images/debug_2.png" alt="debug_2"></p>
<p>我们首先设置条件为偶数，然后再在Action里面选择<code>Debug Command</code>，这和允许我们直接使用<code>lldb</code>或者<code>gdb</code>的命令进行调试，这里我们使用<code>po idx</code>打印出idx的值，表示当满足偶数条件的时候打印。接下来最重要的就是勾选下面那个<code>Automatically continue after evaluating</code>选项，表示在执行动作之后不暂停程序继续运行。</p>
<p><img src="/images/debug_3.png" alt="debug_3"></p>
<p>可以看到，Xcode乖乖地打印除了0到10000的偶数。</p>
<p>假如我们需要输出一些信息，也好办，点击Action右边的加号，添加动作，这次我们选择<code>Log Message</code>，这里可以写下我们需要输出的信息，可以选择在控制台输出或者语音播放，或者也可以再添加一个动作，选择<code>Sound</code>，内置丰富的声音，在您调试的时候也能够享受美妙的交响乐。</p>
<p><img src="/images/debug_4.png" alt="debug_4"></p>
<p>查看输出，同时伴有frog的叫声</p>
<p><img src="/images/debug_5.png" alt="debug_5"> </p>
<h4 id="高级log术的其他用途">高级log术的其他用途</h4><p>平时我们查看调用堆栈的时候都是打个断点然后在Xcode左侧的Debug栏查看，或者在命令行输入lldb命令<code>bt</code>，但是有时候我们不想要程序暂停，这个时候我们就可以使用条件断点的<code>Automatically continue after evaluating</code>，同样，在Action里选择<code>Debug Command</code>，然后输入<code>bt</code>或者<code>bt 10</code>，表示只输出10个frame的调用堆栈。</p>
<p><img src="/images/debug_6.png" alt="debug_6"></p>
<p><code>-viewWillAppear:</code>的调用堆栈如下（只输出了10个frame）</p>
<p><img src="/images/debug_7.png" alt="debug_7"></p>
<p>也可以使用<code>dis -f</code>显示运行时的反汇编代码</p>
<p><img src="/images/debug_8.png" alt="debug_8"></p>
<h4 id="符号断点（Symbolic_BreakPoints）">符号断点（Symbolic BreakPoints）</h4><p><code>Symbolic BreakPoints</code>我们可能用得比较少，但其实它是个神器，用于我们想要在某个方法触发的时候打断点，尤其是当我们使用了第三方库或者framework等我们无法直接在方法里打断点的情况。</p>
<p>好了，假如我们想要在每个<code>-viewDidLoad:</code>执行的时候，打断点，要怎么做呢，首先我们得见一个符号断点</p>
<p><img src="/images/debug_9.png" alt="debug_9"></p>
<p>然后在<code>Symbol</code>里填写我们要追踪的方法，这里填写<code>-[UIViewController viewWillAppear:]</code>。这样，当每次执行到的时候，都会停下来，便于我们分析调试。</p>
<p><img src="/images/debug_10.png" alt="debug_10"></p>
<p>Xcode停留在了第一个断点处</p>
<p><img src="/images/debug_11.png" alt="debug_11"></p>
<p>或者，我们直接输入<code>viewDidLoad</code>，运行，观察Xcode的反应</p>
<p><img src="/images/debug_12.png" alt="debug_12"></p>
<p>执行之后Xcode断点下</p>
<p><img src="/images/debug_13.png" alt="debug_13"></p>
<p>从上图中可以看到，Xcode将程序运行时候所有类中执行到该方法的地方都标记了断点，其中有很多系统类，等于自动<code>class_dump</code>出来了。</p>
<h4 id="全局断点，捕捉程序运行时候的全部异常。">全局断点，捕捉程序运行时候的全部异常。</h4><p>添加断点的时候选择选择<code>Add Exception Breakpoint</code></p>
<p><img src="/images/debug_14.png" alt="debug_14"></p>
<p>然后在编辑的时候我们可以选择捕捉全部或者Objective-C或者C++的异常，一般情况下我们保持默认，这样当出现crash的时候就会停留在相应的代码处了。</p>
<p><img src="/images/debug_15.png" alt="debug_15"></p>
<p>开发程序时，巧妙地利用Xcode强大的调试技巧，可以达到事半功倍的效果。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    

  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



        </div>

        


        

      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/avatar.png" alt="Wild Yaoyao" itemprop="image"/>
          <p class="site-author-name" itemprop="name">Wild Yaoyao</p>
        </div>
        <p class="site-description motion-element" itemprop="description"></p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">9</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">0</span>
              <span class="site-state-item-name">分类</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            
              <span class="site-state-item-count">0</span>
              <span class="site-state-item-name">标签</span>
              
          </div>

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="author" itemprop="copyrightHolder">Wild Yaoyao</span>
</span>
</div>


      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
    

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"wildyao"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>
    
     


    
  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
<script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

<script type="text/javascript" src="/js/motion.js?v=0.4.5.2" id="motion.global"></script>


  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  

  <script type="text/javascript" src="/js/bootstrap.js"></script>

  
  

  
  

</body>
</html>
